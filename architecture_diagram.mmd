graph TD
    subgraph User Interaction
        User[المستخدم]
    end

    subgraph LLM Integration Layer
        LLM_Model(نموذج LLM\nمثل Gemini-2.0-Flash)
        LLM_Wrapper[LLM Wrapper\nGeminiWrapper]
        Prompt_Manager[Prompt Manager]
        LLM_Agent[LLM Agent\nLlmAgent]
    end

    subgraph Core Framework
        Unified_API[Unified Tool API\nSimpleUnifiedToolAPI]
        Tool_Selector[Tool Selector\nSimpleToolSelector]
        Argument_Generator[Argument Generator\nSimpleArgumentGenerator]
        Execution_Layer[Execution Layer]
        Feedback_Loop[Feedback Loop]
    end

    subgraph User-Defined Tools
        Function_Tool_Adapter[Function Tool Adapter]
        User_Tools[أدوات المستخدم\nمثل get_weather, calculate_rectangle_area]
    end

    User -- يرسل استعلام --> LLM_Agent
    LLM_Agent -- يجهز الموجه --> Prompt_Manager
    Prompt_Manager -- يرسل موجه --> LLM_Wrapper
    LLM_Wrapper -- يتفاعل مع --> LLM_Model
    LLM_Model -- يولد استجابة --> LLM_Wrapper
    LLM_Wrapper -- يرسل استجابة --> LLM_Agent

    LLM_Agent -- يطلب اختيار أداة --> Unified_API
    Unified_API -- يطلب اختيار --> Tool_Selector
    Tool_Selector -- يختار أداة --> Unified_API

    Unified_API -- يطلب توليد معاملات --> Argument_Generator
    Argument_Generator -- يولد معاملات --> Unified_API

    Unified_API -- يطلب تنفيذ أداة --> Execution_Layer
    Execution_Layer -- ينفذ --> Function_Tool_Adapter
    Function_Tool_Adapter -- يستدعي --> User_Tools
    User_Tools -- يعيد النتيجة --> Function_Tool_Adapter
    Function_Tool_Adapter -- يعيد النتيجة --> Execution_Layer
    Execution_Layer -- يعيد النتيجة --> Unified_API

    Unified_API -- يعيد النتيجة --> LLM_Agent
    LLM_Agent -- يعالج النتيجة --> Feedback_Loop
    Feedback_Loop -- يحسن الأداء --> LLM_Agent
    LLM_Agent -- يعرض الاستجابة --> User

    Function_Tool_Adapter -- يسجل الأدوات --> Unified_API
    User_Tools -- يتم تحويلها بواسطة --> Function_Tool_Adapter

    classDef subgraphStyle fill:#f9f,stroke:#333,stroke-width:2px;
    class UserInteraction subgraphStyle;
    class LLMIntegrationLayer subgraphStyle;
    class CoreFramework subgraphStyle;
    class UserDefinedTools subgraphStyle;

    style User fill:#ace,stroke:#333,stroke-width:2px;
    style LLM_Model fill:#bbf,stroke:#333,stroke-width:2px;
    style LLM_Wrapper fill:#ccf,stroke:#333,stroke-width:2px;
    style Prompt_Manager fill:#ddf,stroke:#333,stroke-width:2px;
    style LLM_Agent fill:#eef,stroke:#333,stroke-width:2px;
    style Unified_API fill:#fcf,stroke:#333,stroke-width:2px;
    style Tool_Selector fill:#fdf,stroke:#333,stroke-width:2px;
    style Argument_Generator fill:#fef,stroke:#333,stroke-width:2px;
    style Execution_Layer fill:#fff,stroke:#333,stroke-width:2px;
    style Feedback_Loop fill:#efe,stroke:#333,stroke-width:2px;
    style Function_Tool_Adapter fill:#eff,stroke:#333,stroke-width:2px;
    style User_Tools fill:#ffc,stroke:#333,stroke-width:2px;


